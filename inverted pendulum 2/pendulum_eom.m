function dx=pendulum_eom(t,x,K,r0)
% pendulum parameters 
M=1.5;
m1=1;
m2=.5;
l1=1.2;
l2=1.2;
k=0.01;  % linear velocity friction coefficient 
k1=.05;  % rotional velocity friction coefficint
k2=.05;
g=9.81;
F=-K*(x-r0);    % force applied to the cart
%-----%
dx=zeros(6,1);  % system states
% equation of motion 
    dx(1,1)=x(2); 
    dx(2,1)=l1.^(-1).*l2.^(-1).*(2.*M.*m1+m1.^2+M.*m2+m1.*m2+(-1).*m1.*(m1+m2) ...
            .*cos(2.*x(3))+(-1).*M.*m2.*cos(2.*(x(3)+(-1).*x(5)))).^(-1).*(k1.*l2.*( ...
            2.*m1+m2).*x(4).*cos(x(3))+(-1).*k1.*l2.*m2.*x(4).*cos(x(3)+(-2).*x(5))+l1.* ...
            (2.*F.*l2.*m1+F.*l2.*m2+(-2).*k.*l2.*m1.*x(2)+(-1).*k.*l2.*m2.*x(2)+( ...
            -1).*l2.*m2.*(F+(-1).*k.*x(2)).*cos(2.*(x(3)+(-1).*x(5)))+(-1).*k2.*(m1+ ...
            m2).*x(6).*cos(2.*x(3)+(-1).*x(5))+k2.*m1.*x(6).*cos(x(5))+k2.*m2.*x(6).*cos( ...
            x(5))+2.*l1.*l2.*m1.^2.*x(4).^2.*sin(x(3))+2.*l1.*l2.*m1.*m2.*x(4).^2.* ...
            sin(x(3))+(-1).*g.*l2.*m1.^2.*sin(2.*x(3))+(-1).*g.*l2.*m1.*m2.*sin( ...
            2.*x(3))+l2.^2.*m1.*m2.*x(6).^2.*sin(2.*x(3)+(-1).*x(5))+l2.^2.*m1.*m2.* ...
            x(6).^2.*sin(x(5))));
    dx(3,1)=x(4);
    dx(4,1)=(-1).*l1.^(-2).*l2.^(-1).*(2.*M.*m1+m1.^2+M.*m2+m1.*m2+(-1).*m1.*( ...
             m1+m2).*cos(2.*x(3))+(-1).*M.*m2.*cos(2.*(x(3)+(-1).*x(5)))).^(-1).*(2.* ...
             k1.*l2.*M.*x(4)+2.*k1.*l2.*m1.*x(4)+k1.*l2.*m2.*x(4)+l1.*l2.*(2.*m1+m2) ...
             .*(F+(-1).*k.*x(2)).*cos(x(3))+(-1).*l1.*l2.*m2.*(F+(-1).*k.*x(2)).*cos( ...
              x(3)+(-2).*x(5))+(-2).*k2.*l1.*M.*x(6).*cos(x(3)+(-1).*x(5))+(-1).*k2.*l1.* ...
              m1.*x(6).*cos(x(3)+(-1).*x(5))+(-1).*k2.*l1.*m2.*x(6).*cos(x(3)+(-1).*x(5))+( ...
              -1).*k1.*l2.*m2.*x(4).*cos(2.*x(5))+k2.*l1.*m1.*x(6).*cos(x(3)+x(5))+k2.* ...
              l1.*m2.*x(6).*cos(x(3)+x(5))+(-2).*g.*l1.*l2.*M.*m1.*sin(x(3))+(-2).*g.* ...
              l1.*l2.*m1.^2.*sin(x(3))+(-1).*g.*l1.*l2.*M.*m2.*sin(x(3))+(-2).*g.* ...
              l1.*l2.*m1.*m2.*sin(x(3))+l1.^2.*l2.*m1.^2.*x(4).^2.*sin(2.*x(3))+ ...
              l1.^2.*l2.*m1.*m2.*x(4).^2.*sin(2.*x(3))+(-1).*g.*l1.*l2.*M.*m2.*sin( ...
              x(3)+(-2).*x(5))+2.*l1.*l2.^2.*M.*m2.*x(6).^2.*sin(x(3)+(-1).*x(5))+l1.* ...
              l2.^2.*m1.*m2.*x(6).^2.*sin(x(3)+(-1).*x(5))+l1.^2.*l2.*M.*m2.*x(4).^2.* ...
              sin(2.*(x(3)+(-1).*x(5)))+l1.*l2.^2.*m1.*m2.*x(6).^2.*sin(x(3)+x(5)));
    dx(5,1)=x(6);
    dx(6,1)=(-1).*l1.^(-1).*l2.^(-2).*m2.^(-1).*(2.*M.*m1+m1.^2+M.*m2+m1.*m2+( ...
            -1).*m1.*(m1+m2).*cos(2.*x(3))+(-1).*M.*m2.*cos(2.*(x(3)+(-1).*x(5)))) ...
            .^(-1).*(2.*k2.*l1.*M.*m1.*x(6)+k2.*l1.*m1.^2.*x(6)+2.*k2.*l1.*M.*m2.* ...
            x(6)+2.*k2.*l1.*m1.*m2.*x(6)+k2.*l1.*m2.^2.*x(6)+(-1).*k2.*l1.*(m1+m2) ...
            .^2.*x(6).*cos(2.*x(3))+(-1).*k1.*l2.*m2.*(2.*M+m1+m2).*x(4).*cos(x(3)+( ...
            -1).*x(5))+(-1).*F.*l1.*l2.*m1.*m2.*cos(2.*x(3)+(-1).*x(5))+(-1).*F.* ...
            l1.*l2.*m2.^2.*cos(2.*x(3)+(-1).*x(5))+k.*l1.*l2.*m1.*m2.*x(2).*cos(2.* ...
            x(3)+(-1).*x(5))+k.*l1.*l2.*m2.^2.*x(2).*cos(2.*x(3)+(-1).*x(5))+F.*l1.*l2.* ...
            m1.*m2.*cos(x(5))+F.*l1.*l2.*m2.^2.*cos(x(5))+(-1).*k.*l1.*l2.*m1.* ...
            m2.*x(2).*cos(x(5))+(-1).*k.*l1.*l2.*m2.^2.*x(2).*cos(x(5))+k1.*l2.*m1.* ...
            m2.*x(4).*cos(x(3)+x(5))+k1.*l2.*m2.^2.*x(4).*cos(x(3)+x(5))+(-2).*l1.^2.*l2.* ...
            M.*m1.*m2.*x(4).^2.*sin(x(3)+(-1).*x(5))+(-2).*l1.^2.*l2.*M.*m2.^2.* ...
            x(4).^2.*sin(x(3)+(-1).*x(5))+(-1).*l1.*l2.^2.*M.*m2.^2.*x(6).^2.*sin(2.*( ...
            x(3)+(-1).*x(5)))+g.*l1.*l2.*M.*m1.*m2.*sin(2.*x(3)+(-1).*x(5))+g.*l1.* ...
            l2.*M.*m2.^2.*sin(2.*x(3)+(-1).*x(5))+(-1).*g.*l1.*l2.*M.*m1.*m2.*sin( ...
            x(5))+(-1).*g.*l1.*l2.*M.*m2.^2.*sin(x(5)));
 

end

 